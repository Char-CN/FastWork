#!/usr/bin/expect -f
set timeout 3
set name "root"
set ip ""
set passwd ""
set port "-p22"
foreach i { 0 2 4 6 } {
    #puts $i
    #puts [lindex $argv [expr {$i + 1}]]
    if { [lindex $argv $i] == "-u" } {
        set name "-l[lindex $argv [expr {$i + 1}]]"
    }
    if { [lindex $argv $i] == "-P" } {
        set passwd "[lindex $argv [expr {$i + 1}]]"
    }
    if { [lindex $argv $i] == "-h" } {
        set ip "[lindex $argv [expr {$i + 1}]]"
    }
    if { [lindex $argv $i] == "-p" } {
        set port "-p[lindex $argv [expr {$i + 1}]]"
    }
}
spawn ssh $port $name $ip
if { "$passwd" != ""  } {
    expect {
        "yes/no" { send "yes\r"; exp_continue }
        "pass" { send "$passwd\r" }
    }
}
interact
